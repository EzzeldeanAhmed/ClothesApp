<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NOTCHILLY Hoodies</title>
  <link rel="icon" href="./img/Beige and Grey Minimalist Modern Bold Typographic Brand Logo.png">
  <link rel="stylesheet" href="./style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
  <header>
    <img src="./img/Beige and Grey Minimalist Modern Bold Typographic Brand Logo.png">
    <nav>
      <a href="#shop">Shop</a>
      <a href="./about.html">About</a>
      <a href="./contact.html">Contact</a>
      <a href="./ourpolicy.html">Our policy </a>
      <span id="user-display" style="margin-right:.75rem"></span>
      <button id="auth-btn" class="cart-btn">Login</button>
      <button id="open-cart">Cart (<span id="cart-count">0</span>)</button>

      <button id="logout-btn" class="logout-btn" style="display:none; margin-right:.5rem">Logout</button>

    </nav>
  </header>

  <div class="container">
    <section id="shop">
      <h2 style="color:var(--primary)">Our Hoodies</h2>
      <div id="products" class="grid"></div>
    </section>


    <section id="contact" style="margin-top:2rem">
      <h2 style="color:var(--primary)"></h2>
      <form id="contact-form">

      </form>
    </section>
  </div>



  <footer class="footer">
    <div class="footer-container">

      <!-- Brand -->
      <div class="footer-brand">
        <h2>NOTCHILLY </h2>
        <p>Stay Lit, Not Chilly ðŸ”¥</p>
      </div>

      <!-- Contact -->
      <div class="footer-contact">
        <p>ðŸ“§ <a href="mailto:support@notchilly.com">support@notchilly.com</a></p>
        <p>ðŸ“ž <a href="tel:+201234567890">+20 123 456 7890</a></p>
      </div>

      <!-- Social -->
      <div class="footer-social">
        <a href="https://facebook.com" target="_blank" class="social-icon"><i class="fab fa-facebook"></i></a>
        <a href="https://instagram.com" target="_blank" class="social-icon"><i class="fab fa-instagram"></i></a>
        <a href="mailto:support@notchilly.com" class="social-icon"><i class="fas fa-envelope"></i></a>
      </div>
    </div>


    </div>
  </footer>




  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-card">
      <img id="modal-image" src="./img/download (3).jfif" alt="" />
      <div>
        <h3 id="modal-title"></h3>
        <p id="modal-desc"></p>
        <div class="price" id="modal-price"></div>
        <label>Size</label>
        <select id="modal-size">
          <option>S</option>
          <option>M</option>
          <option>L</option>
          <option>XL</option>
        </select><br><br>
        <label>Color</label>
        <select id="modal-color">
          <option>Black</option>
          <option>White</option>
          <option>Burgundy</option>
        </select><br><br>
        <button id="add-to-cart">Add to Cart</button>
        <button id="close-modal" class="cart-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Cart Sidebar -->
  <div id="cart" class="cart-side">
    <div class="cart-header">
      <h3>Cart</h3>
      <button id="close-cart" class="close-btn">&times;</button>
    </div>
    <div id="cart-items"></div>
    <strong>Total: <span id="cart-total">0 EGP</span></strong>
    <button id="checkout" style="margin-top:1rem">Checkout</button>
    <button id="empty-cart" class="cart-btn" style="margin-top:.5rem">Empty</button>
  </div>

  <!-- Payment Modal -->
  <div class="payment-modal" id="payment-modal">
    <div class="payment-card">
      <div class="payment-header">
        <h3>Payment Details</h3>
        <button id="close-payment" class="close-btn">&times;</button>
      </div>
      <form id="payment-form">
        <div class="form-group">
          <label for="card-number">Card Number</label>
          <input type="text" id="card-number" placeholder="1234 5678 9012 3456" maxlength="19" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="expiry-date">Expiry Date</label>
            <input type="text" id="expiry-date" placeholder="MM/YY" maxlength="5" required>
          </div>
          <div class="form-group">
            <label for="cvv">CVV</label>
            <input type="text" id="cvv" placeholder="123" maxlength="4" required>
          </div>
        </div>
        <div class="form-group">
          <label for="card-name">Cardholder Name</label>
          <input type="text" id="card-name" placeholder="John Doe" required>
        </div>
        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" placeholder="john@example.com" required>
        </div>
        <div class="payment-summary">
          <h4>Order Summary</h4>
          <div id="payment-items"></div>
          <div class="payment-total">
            <strong>Total: <span id="payment-total">0 EGP</span></strong>
          </div>
        </div>
        <div class="payment-buttons">
          <button type="button" id="back-to-cart" class="cart-btn">Back to Cart</button>
          <button type="submit" id="process-payment">Pay Now</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Payment Success Modal -->
  <div class="success-modal" id="success-modal">
    <div class="success-card">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h2>Payment Successful!</h2>
      <p>Thank you for your purchase. Your order has been confirmed and will be processed shortly.</p>
      <div class="order-details">
        <div class="order-info">
          <span>Order ID:</span>
          <span id="order-id">#12345</span>
        </div>
        <div class="order-info">
          <span>Total Amount:</span>
          <span id="success-total">0 EGP</span>
        </div>
        <div class="order-info">
          <span>Email:</span>
          <span id="success-email">customer@example.com</span>
        </div>
      </div>
      <div class="success-buttons">
        <button id="continue-shopping" class="success-btn">Continue Shopping</button>
        <button id="view-order" class="cart-btn">View Order Details</button>
      </div>
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="payment-modal" id="auth-modal" style="z-index:1100;">
    <div class="payment-card">
      <div class="payment-header">
        <h3 id="auth-title">Login</h3>
        <button id="close-auth" class="close-btn">&times;</button>
      </div>
      <div class="payment-buttons" style="margin-top:0">
        <button id="show-login" class="success-btn">Login</button>
        <button id="show-register" class="cart-btn">Register</button>
      </div>
      <form id="login-form" style="margin-top:1rem">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" placeholder="you@example.com" required>
        </div>
        <div class="form-group">
          <label for="login-password">Password</label>
          <input type="password" id="login-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
        </div>
        <div class="payment-buttons">
          <button type="submit" id="login-submit">Login</button>
        </div>
      </form>
      <form id="register-form" style="display:none; margin-top:1rem">
        <div class="form-group">
          <label for="register-name">Full Name</label>
          <input type="text" id="register-name" placeholder="John Doe" required>
        </div>
        <div class="form-group">
          <label for="register-email">Email</label>
          <input type="email" id="register-email" placeholder="you@example.com" required>
        </div>
        <div class="form-group">
          <label for="register-password">Password</label>
          <input type="password" id="register-password" placeholder="Min 6 characters" required>
        </div>
        <div class="payment-buttons">
          <button type="submit" id="register-submit">Create Account</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const products = [
      { id: 1, title: "Evil Eye Off Shoulder Hoodie", desc: "Oversized, fleece cotton 350gsm.", price: 1200, image: "./img/Patchwork schulterfrei Hoodie Evil Eye.jfif" },
      { id: 1, title: "Gray Hoodie", desc: "Oversized, fleece cotton 350gsm.", price: 1050, image: "./img/download (3).jfif" },
      { id: 1, title: "burgandy oversize heat Hoodie", desc: "Oversized, fleece cotton 350gsm.", price: 950, image: "./img/DAZY Contrast Color Block Turndown Collar Loose Fleece Sweatshirt For Women.jfif" },
      { id: 1, title: "Classic stitched(Ø­Ø¨) Black Hoodie", desc: "Oversized, fleece cotton 350gsm.", price: 1050, image: "./img/Swagger & Ink.jfif" },
      { id: 1, title: "white oversize sweatshirt", desc: "Oversized, fleece cotton 350gsm.", price: 950, image: "./img/Artwork WEYZ.jfif" },
      { id: 1, title: "Dark Gray Hoodie", desc: "Oversized, fleece cotton 350gsm.", price: 950, image: "./img/stussy i-d world tour hoodie.jfif" },
      { id: 2, title: "Stared gray Hoodie", desc: "Logo stitched, eco-friendly fabric.", price: 1100, image: "./img/download.jfif" },
      { id: 3, title: "Balle de billard Hoodie", desc: "Streetwear cut, bold burgundy.", price: 1050, image: "./img/Sweat Balle de billard.jfif" }
    ];
    const productsEl = document.getElementById("products"), modal = document.getElementById("modal");
    const modalImg = document.getElementById("modal-image"), modalTitle = document.getElementById("modal-title");
    const modalDesc = document.getElementById("modal-desc"), modalPrice = document.getElementById("modal-price");
    const cartEl = document.getElementById("cart"), cartItemsEl = document.getElementById("cart-items");
    const cartCount = document.getElementById("cart-count"), cartTotal = document.getElementById("cart-total");
    const paymentModal = document.getElementById("payment-modal"), paymentItemsEl = document.getElementById("payment-items");
    const paymentTotal = document.getElementById("payment-total");
    const successModal = document.getElementById("success-modal");
    const orderId = document.getElementById("order-id");
    const successTotal = document.getElementById("success-total");
    const successEmail = document.getElementById("success-email");
    const authBtn = document.getElementById("auth-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const userDisplay = document.getElementById("user-display");
    const authModal = document.getElementById("auth-modal");
    const closeAuth = document.getElementById("close-auth");
    const showLogin = document.getElementById("show-login");
    const showRegister = document.getElementById("show-register");
    const authTitle = document.getElementById("auth-title");
    const loginForm = document.getElementById("login-form");
    const registerForm = document.getElementById("register-form");
    let current = null; let cart = [];
    let currentUser = null;
    function renderProducts() {
      productsEl.innerHTML = "";
      products.forEach(p => {
        const card = document.createElement("div");
        card.className = "product";
        card.innerHTML = `<img src="${p.image}" alt="${p.title}"><h3>${p.title}</h3><div class="price">${p.price} EGP</div>`;
        card.addEventListener("click", () => openModal(p));
        productsEl.appendChild(card);
      });
    }
    function openModal(p) {
      current = p; modal.classList.add("open");
      modalImg.src = p.image; modalTitle.textContent = p.title; modalDesc.textContent = p.desc;
      modalPrice.textContent = p.price + " EGP";
    }
    document.getElementById("close-modal").addEventListener("click", () => modal.classList.remove("open"));
    document.getElementById("add-to-cart").addEventListener("click", () => {
      const size = document.getElementById("modal-size").value;
      const color = document.getElementById("modal-color").value;
      const item = { ...current, size, color, qty: 1 };
      cart.push(item); renderCart(); modal.classList.remove("open");
    });
    document.getElementById("open-cart").addEventListener("click", () => {
      cartEl.style.display = cartEl.style.display === "flex" ? "none" : "flex";
    });
    document.getElementById("close-cart").addEventListener("click", () => {
      cartEl.style.display = "none";
    });
    document.getElementById("empty-cart").addEventListener("click", () => { cart = []; renderCart(); });
    function renderCart() {
      cartItemsEl.innerHTML = ""; let total = 0;
      cart.forEach((it, i) => {
        total += it.price * it.qty;
        cartItemsEl.innerHTML += `<div class="cart-item"><img src="${it.image}"><div>${it.title}<br><small>${it.size} / ${it.color}</small></div><div>${it.price} EGP</div></div>`;
      });
      cartCount.textContent = cart.length; cartTotal.textContent = total + " EGP";
    }

    document.getElementById("checkout").addEventListener("click", () => {
      if (cart.length === 0) return alert("Cart empty");
      renderPaymentSummary();
      paymentModal.classList.add("open");
    });

    document.getElementById("close-payment").addEventListener("click", () => {
      paymentModal.classList.remove("open");
    });

    document.getElementById("back-to-cart").addEventListener("click", () => {
      paymentModal.classList.remove("open");
    });

    function renderPaymentSummary() {
      paymentItemsEl.innerHTML = "";
      let total = 0;
      cart.forEach(item => {
        total += item.price * item.qty;
        const paymentItem = document.createElement("div");
        paymentItem.className = "payment-item";
        paymentItem.innerHTML = `
          <span>${item.title} (${item.size}/${item.color})</span>
          <span>${item.price} EGP</span>
        `;
        paymentItemsEl.appendChild(paymentItem);
      });
      paymentTotal.textContent = total + " EGP";
    }

    // Format card number input
    document.getElementById("card-number").addEventListener("input", (e) => {
      let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
      let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
      e.target.value = formattedValue;
    });

    // Format expiry date input
    document.getElementById("expiry-date").addEventListener("input", (e) => {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length >= 2) {
        value = value.substring(0, 2) + '/' + value.substring(2, 4);
      }
      e.target.value = value;
    });

    // Format CVV input
    document.getElementById("cvv").addEventListener("input", (e) => {
      e.target.value = e.target.value.replace(/[^0-9]/g, '');
    });

    document.getElementById("payment-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const order = {
        items: cart,
        total: cart.reduce((s, i) => s + i.price, 0),
        payment: {
          cardNumber: document.getElementById("card-number").value,
          expiryDate: document.getElementById("expiry-date").value,
          cvv: document.getElementById("cvv").value,
          cardName: document.getElementById("card-name").value,
          email: document.getElementById("email").value
        }
      };

      try {
        const res = await fetch("https://jsonplaceholder.typicode.com/posts", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(order)
        });
        const data = await res.json();

        // Show success screen
        showSuccessScreen(data.id, order.total, order.payment.email);

        // Clear cart and reset form
        cart = [];
        renderCart();
        paymentModal.classList.remove("open");
        document.getElementById("payment-form").reset();
      } catch (e) {
        alert("Payment failed: " + e.message);
      }
    });

    function showSuccessScreen(orderIdValue, total, email) {
      orderId.textContent = "#" + orderIdValue;
      successTotal.textContent = total + " EGP";
      successEmail.textContent = email;
      successModal.classList.add("open");
    }

    document.getElementById("continue-shopping").addEventListener("click", () => {
      successModal.classList.remove("open");
    });

    document.getElementById("view-order").addEventListener("click", () => {
      successModal.classList.remove("open");
      alert("Order details feature coming soon!");
    });

    // JSON-based Authentication System
    let usersData = { users: [] };

    // Load users from localStorage first; if none, attempt JSON fetch (optional)
    async function loadUsers() {
      try {
        const stored = localStorage.getItem('usersData');
        if (stored) {
          usersData = JSON.parse(stored);
          return;
        }
        // Optional: attempt to fetch users.json when served via HTTP (not file://)
        if (location.protocol.startsWith('http')) {
          const response = await fetch('./users.json');
          if (response.ok) {
            usersData = await response.json();
            localStorage.setItem('usersData', JSON.stringify(usersData));
          }
        }
      } catch (error) {
        console.warn('Could not load users data:', error);
      }
    }

    // Save users to localStorage (no server required)
    async function saveUsers() {
      try {
        localStorage.setItem('usersData', JSON.stringify(usersData));
      } catch (error) {
        console.error('Error saving users:', error);
        alert('Error saving user data');
      }
    }

    // Auth modal controls
    function openAuth(tab = "login") {
      authModal.classList.add("open");
      if (tab === "register") {
        authTitle.textContent = "Register";
        loginForm.style.display = "none";
        registerForm.style.display = "block";
      } else {
        authTitle.textContent = "Login";
        loginForm.style.display = "block";
        registerForm.style.display = "none";
      }
    }

    function setUserUI(user) {
      currentUser = user;
      if (user) {
        userDisplay.textContent = (user.name && user.name.trim()) ? user.name : user.email;
        authBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        localStorage.setItem('currentUser', JSON.stringify(user));
      } else {
        userDisplay.textContent = "";
        authBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
        localStorage.removeItem('currentUser');
      }
    }

    // Event listeners for auth
    closeAuth.addEventListener("click", () => authModal.classList.remove("open"));
    showLogin.addEventListener("click", () => openAuth("login"));
    showRegister.addEventListener("click", () => openAuth("register"));

    authBtn.addEventListener("click", () => {
      openAuth("login");
    });

    logoutBtn.addEventListener("click", () => {
      setUserUI(null);
      // Redirect to login page after logout
      window.location.href = './login.html';
    });

    // Register form handler
    registerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("register-name").value.trim();
      const email = document.getElementById("register-email").value.trim();
      const password = document.getElementById("register-password").value;

      if (password.length < 6) {
        alert("Password must be at least 6 characters long");
        return;
      }

      // Check if user already exists
      const existingUser = usersData.users.find(user => user.email === email);
      if (existingUser) {
        alert("User with this email already exists");
        return;
      }

      // Create new user
      const newUser = {
        id: Date.now().toString(),
        name,
        email,
        password, // In real app, hash this password
        createdAt: new Date().toISOString()
      };

      usersData.users.push(newUser);
      await saveUsers();

      setUserUI({ email: newUser.email, name: newUser.name });
      authModal.classList.remove("open");
      registerForm.reset();
      alert("Account created successfully!");
    });

    // Login form handler
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("login-email").value.trim();
      const password = document.getElementById("login-password").value;

      const user = usersData.users.find(u => u.email === email && u.password === password);
      if (user) {
        setUserUI({ email: user.email, name: user.name });
        authModal.classList.remove("open");
        loginForm.reset();
        alert("Login successful!");
      } else {
        alert("Invalid email or password");
      }
    });

    // Initialize
    loadUsers();
    // Check authentication on page load
    try {
      const cu = localStorage.getItem('currentUser');
      if (cu) {
        setUserUI(JSON.parse(cu));
      } else {
        // Redirect to login page if not authenticated
        window.location.href = './login.html';
      }
    } catch (error) {
      console.error('Auth check error:', error);
      window.location.href = './login.html';
    }

    // Contact form demo
    document.getElementById("contact-form").addEventListener("submit", async (e) => {
      e.preventDefault(); document.getElementById("c-status").textContent = "Sendingâ€¦";
      const payload = { name: document.getElementById("c-name").value, email: document.getElementById("c-email").value, message: document.getElementById("c-message").value };
      try {
        const res = await fetch("https://jsonplaceholder.typicode.com/posts", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
        const data = await res.json(); document.getElementById("c-status").style.color = "green"; document.getElementById("c-status").textContent = "Sent! (demo id: " + data.id + ")"; e.target.reset();
      } catch (e) { document.getElementById("c-status").style.color = "red"; document.getElementById("c-status").textContent = "Failed"; }
    });
    renderProducts();
  </script>
</body>

</html>